Global $edids[3] = ["/* 0000 */   0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,|/* 0008 */   0x00, 0x00, 0x17, 0x07, 0x00, 0x00, 0x00, 0x00,|/* 0010 */   0x00, 0x0C, 0x01, 0x03, 0x80, 0x1D, 0x10, 0xFF,|/* 0018 */   0x2F, 0x00, 0x00, 0xA0, 0x57, 0x49, 0x9B, 0x26,|/* 0020 */   0x10, 0x48, 0x4F, 0x00, 0x00, 0x00, 0x01, 0x01,|/* 0028 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,|/* 0030 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xBB, 0x1D,|/* 0038 */   0x56, 0xC2, 0x50, 0x00, 0x2E, 0x30, 0x1F, 0x41,|/* 0040 */   0x4C, 0x00, 0x25, 0xA5, 0x10, 0x00, 0x00, 0x18,|/* 0048 */   0x65, 0x17, 0x56, 0x9A, 0x50, 0x00, 0x14, 0x30,|/* 0050 */   0x1F, 0x2D, 0x48, 0x00, 0x25, 0xA5, 0x10, 0x00,|/* 0058 */   0x00, 0x18, 0x89, 0x13, 0x56, 0xC2, 0x50, 0x00,|/* 0060 */   0x21, 0x30, 0x1F, 0x41, 0x4C, 0x00, 0x25, 0xA5,|/* 0068 */   0x10, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00,|/* 0070 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,|/* 0078 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x90","/* 0000 */   0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,|/* 0008 */   0x4D, 0xD9, 0xFA, 0x06, 0x0D, 0x00, 0x00, 0x00,|/* 0010 */   0x00, 0x0C, 0x01, 0x03, 0x80, 0x1D, 0x10, 0xFF,|/* 0018 */   0x2F, 0x00, 0x00, 0xA0, 0x57, 0x49, 0x9B, 0x26,|/* 0020 */   0x10, 0x48, 0x4F, 0x00, 0x00, 0x00, 0x01, 0x01,|/* 0028 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,|/* 0030 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x0E, 0x27,|/* 0038 */   0x40, 0xB8, 0x60, 0x84, 0x23, 0x30, 0x1E, 0x1E,|/* 0040 */   0x11, 0x00, 0x25, 0xA5, 0x10, 0x00, 0x00, 0x18,|/* 0048 */   0x7A, 0x23, 0x40, 0x2C, 0x61, 0x84, 0x38, 0x30,|/* 0050 */   0x1E, 0x3C, 0x14, 0x00, 0x25, 0xA5, 0x10, 0x00,|/* 0058 */   0x00, 0x18, 0x62, 0x1C, 0x40, 0x2C, 0x61, 0x84,|/* 0060 */   0x38, 0x30, 0x1E, 0x3C, 0x14, 0x00, 0x25, 0xA5,|/* 0068 */   0x10, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00,|/* 0070 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,|/* 0078 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x40","/* 0000 */   0x00, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0x00,|/* 0008 */   0x36, 0x7F, 0x25, 0x00, 0x0F, 0x00, 0x00, 0x00,|/* 0010 */   0x00, 0x0C, 0x01, 0x03, 0x80, 0x22, 0x13, 0xFF,|/* 0018 */   0x2F, 0x00, 0x00, 0xA0, 0x57, 0x49, 0x9B, 0x26,|/* 0020 */   0x10, 0x48, 0x4F, 0x00, 0x00, 0x00, 0x01, 0x01,|/* 0028 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01,|/* 0030 */   0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0x54, 0x38,|/* 0038 */   0x80, 0xC4, 0x70, 0x38, 0x39, 0x40, 0x30, 0x48,|/* 0040 */   0x35, 0x00, 0x58, 0xC2, 0x10, 0x00, 0x00, 0x18,|/* 0048 */   0x54, 0x38, 0x80, 0xE0, 0x71, 0x38, 0x7A, 0x40,|/* 0050 */   0x30, 0x48, 0x35, 0x00, 0x58, 0xC2, 0x10, 0x00,|/* 0058 */   0x00, 0x18, 0x54, 0x29, 0x80, 0x68, 0x71, 0x38,|/* 0060 */   0x50, 0x40, 0x30, 0x48, 0x35, 0x00, 0x58, 0xC2,|/* 0068 */   0x10, 0x00, 0x00, 0x18, 0x00, 0x00, 0x00, 0x00,|/* 0070 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,|/* 0078 */   0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xC7"]
Global $res[3] = ["1366x768","1600x900","1920x1080"]
$pad = "                            "
$dualLink = '"AAPL00,DualLink", ' & @CRLF & '                        Buffer (0x04)' & @CRLF & '                        {' & @CRLF & '                             0x01, 0x00, 0x00, 0x00' & @CRLF & '                        },'

$baseFile = @WorkingDir & "\DSDT.dsl"
$baseText = FileRead ( $baseFile )

DirCreate (@WorkingDir & "\Out")

For $i = 0 To 2 Step 1
   $normalResult = @WorkingDir & "\Out\DSDT_" & $res[$i] & ".dsl"
   $batteryResult = @WorkingDir & "\Out\DSDT_" & $res[$i] & "_alt_battery.dsl"
   $compileName = "DSDT_" & $res[$i] & ".aml"
      
   $corrected = StringReplace ($baseText, "<FILENAME HERE>", $compileName)
   $injected = StringReplace ($corrected, "<EDID HERE>", StringReplace ( $edids[$i], "|", @CRLF & $pad ) )
   
   if ( $res[$i] == "1366x768" ) Then
	  $injected = StringReplace ($injected, $dualLink, "")
   EndIf
   
   $battery = addBattery ( $injected )
   $battery = StringReplace ($battery, ".aml", "_alt_battery.aml")
   
   FileDelete ( $normalResult )
   FileDelete ( $batteryResult )
   FileWrite ( $normalResult , $injected )
   Run ( ".\iasl.exe " & $normalResult )
   FileWrite ( $batteryResult , $battery )
   Run ( ".\iasl.exe " & $batteryResult  )
Next 

Func addBattery($file)
   Local $batVars[12] = ["B1RA","B1FC","B1DC","B1DV","B1SC","B1RC","B1FV","B1AI","B1TM","B1SE","B1CI","B1CV"]
   Local $replace1[12] = ["B1RB","B1FD","B1DD","B1DW","B1SD","B1RD","B1FW","B1AJ","B1TN","B1SF","B1CJ","B1CW"]
   For $i = 0 To 11 Step 1
	  $file = StringReplace ( $file, $batVars[$i] & ",   16", $batVars[$i] & ",   8," & @CRLF & "                        " & $replace1[$i] & ",   8" )
	  $file = StringReplace ( $file, "(" & $batVars[$i], "(B1B2 (" & $batVars[$i] & ", " & $replace1[$i] & ")" ) 
   Next
   $file = StringReplace ( $file, "Method (P8XH, 3, Serialized)", "    Method (B1B2, 2, NotSerialized)" & @CRLF & "    {" & @CRLF & "        Or (ShiftLeft (Arg1, 0x08), Arg0, Local0)" & @CRLF & "        Return (Local0)" & @CRLF & "    }" & @CRLF & @CRLF & "    Method (P8XH, 3, Serialized)")
   Return $file
EndFunc
